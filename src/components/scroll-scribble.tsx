import React, { useEffect, useRef } from "react";
import Image from "next/image";
import { useTheme } from "next-themes";

interface ScrollDrivenScribblesProps {
  imagePath: string;
}

const ScrollDrivenScribbles: React.FC<ScrollDrivenScribblesProps> = ({
  imagePath,
}) => {
  const pathRef = useRef<SVGPathElement | null>(null);
  const scribbleOverlayRef = useRef<HTMLDivElement | null>(null);
  const { theme } = useTheme();

  

  useEffect(() => {
    if (pathRef.current) {
      const length = pathRef.current.getTotalLength();
      pathRef.current.style.strokeDasharray = `${length}`;
      pathRef.current.style.strokeDashoffset = `${length}`;
    }
    

    if (scribbleOverlayRef.current) {
      scribbleOverlayRef.current.style.mixBlendMode =
        theme === "dark" ? "darken" : "lighten";
      scribbleOverlayRef.current.style.backgroundColor =
        theme === "dark" ? "black" : "white";
    }

    if (pathRef.current) {
      pathRef.current.style.stroke = theme === "dark" ? "white" : "black";
    }
  }, [theme]);

  return (
    <div className="scroll-driven-scribbles flex rounded-full"  >
      <div className="relative grid h-[30dvh] sm:h-[20dvh] lg:h-[45dvh] xl:h-[50dvh] w-full" >
        <div
          ref={scribbleOverlayRef}
          className="scribble-overlay absolute z-20 w-full h-full flex justify-center items-center rounded-[40px] "
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
  viewBox="-20 -102 600 1040"
            strokeLinecap="round"
            strokeLinejoin="round"
            className="scribble-path w-full h-full"
          >
            <path
              ref={pathRef}
              d="M214.84,3.46c-16.93,5.53-34.23,12.76-49.22,22.66-15.27,10.08-29.78,21.73-43.36,34.03-10.72,9.71-20.92,19.97-31.69,29.63-10.33,9.27-20.56,18.67-30.22,28.64-5.06,5.22-9.98,10.6-14.52,16.28-8.09,10.1-17.8,20.99-24,32.83-4.55,8.67-8.59,18.11-11.63,27.38s-4.32,19.91-4.32,29.8c0,17.71,4.35,34.28,13.01,49.66,2.4,4.26,3.75,5.38,8.06,10.96,8.27,10.71,13.85,17.57,27.19,24.75,25.18,13.57,53.99,17.12,82.16,14.69,17.64-1.52,35.71-3.74,52.74-8.95,18.18-5.56,35.82-13.42,52.93-21.61,21.71-10.38,42.55-22.79,63.22-35.07,23.87-14.18,47.24-29.26,69.57-45.79,9.09-6.73,18.29-13.25,27.43-19.89,19.48-14.16,40.83-29.63,51.89-51.99,8.14-14.04,12.24-29.18,12.29-45.42,.47-12.39-2.12-23.95-7.75-34.68-3.63-11.16-9.83-20.81-18.61-28.96-11.23-11.15-24.47-18.87-39.71-23.15-1.28-.36-2.54-.59-3.84-.83-8.66-1.59-18.09-3.22-26.94-3.45-1.22-.03-2.44,.03-3.65,.12-9.11,.64-18.7,2.12-27.7,3.71-13.42,2.38-26.68,9.31-38.65,14.81-12.67,5.83-24.29,13.73-35.75,21.6-11.77,8.09-24,15.42-35.89,23.35-20.52,13.68-40.22,28.78-59.08,44.65-28.25,23.75-51.9,51.57-75.71,79.62-17.48,20.59-34.32,41.68-50.49,63.32-5.64,7.55-11.1,15.24-16.27,23.13-2.44,3.73-4.77,7.5-6.66,11.55-4.78,10.22-9.73,20.78-12.9,31.68-1.16,3.97-1.92,8.02-2.52,12.11-1.7,11.61-3.72,23.35-4.11,35.12-.13,3.78-.2,7.6,.07,11.38,.7,9.97,1.94,20.27,4.05,30.06,1.19,5.53,3.95,10.79,6.09,15.88,2.28,5.39,3.96,10.65,7.13,15.45,4.79,7.24,10.28,15.01,16.78,21.18,4.85,4.61,13.83,11.28,19.38,15.02,.84,.56,1.66,1.1,2.55,1.58,3.78,2.07,9.7,4.15,12.4,5.29,3.71,1.56,8.45,3.96,12.79,5.25,8.74,2.6,22.1,3.58,28.35,4.1,11.32,.94,24.34-1.84,34.71-3.49,16.47-2.61,31.96-10.29,47.08-16.79,18.58-7.99,36.01-18.38,52.93-29.41,20.5-13.37,40.93-26.88,61.3-40.45,33.34-22.21,66.31-45.02,98.18-69.31,21.12-16.1,41.76-32.68,62.49-49.25,14.6-11.68,29.41-23.13,43.25-35.72,6.88-6.26,13.48-12.82,19.65-19.78l14.07-18.21c6.58-10.33,10.14-21.48,10.68-33.46,2.14-7.98,2.14-15.95,0-23.93-.54-11.98-4.1-23.13-10.68-33.46-8.39-13.01-19.27-23.9-32.29-32.29-10.33-6.58-21.48-10.14-33.46-10.68-11.96-2.68-23.93-2.14-35.89,1.61-12.51,2.38-23.84,7.13-35.54,12.07s-23.37,10.06-34.41,16.72c-21.86,13.19-41.86,29.59-61.91,45.26-31.25,24.41-61.53,49.73-90.22,77.13-29.03,27.72-56.35,57.03-83.1,86.94-12.3,13.75-25.13,27.01-37.66,40.54-17.77,19.19-34.14,39.2-49.97,60.04-15.65,20.6-28.18,42.62-36.41,67.35-.74,2.22-1.35,4.49-1.8,6.79-1.84,9.41-3.41,19.59-3.92,29.13-.13,2.36-.07,4.66,.12,7.02,.66,8.11,1.88,17.71,3.46,25.69,.26,1.32,.52,2.62,.9,3.91,5.54,18.89,14.37,34.76,27.97,48.97,.59,.62,1.18,1.22,1.81,1.8,.3,.29,.66,.52,.97,.79,3.96,3.39,14.38,11.71,18.72,14.44,.71,.44,1.4,.88,2.13,1.29,6.57,3.68,16.4,7.53,23.5,9.97,1.55,.53,3.08,.92,4.68,1.23,7.99,1.57,17.8,2.89,25.94,3.46,1.17,.08,2.34,.13,3.52,.11,16.91-.28,34.29-3.4,50.03-9.75,17.31-7,33.98-14.18,49.95-23.77,8.96-5.38,17.67-11.18,26.21-17.21,24.71-17.44,48.91-35.84,72.05-55.28,58.87-49.47,109.22-107.96,166.33-159.33,6.92-6.23,13.95-12.34,21.08-18.33,4.69-6.07,9.38-12.14,14.07-18.21,3.02-7.17,6.05-14.33,9.07-21.5l3.21-23.93c.47-12.39-2.12-23.95-7.75-34.68-2.14-7.62-6-14.24-11.57-19.86-4-6.76-9.38-12.14-16.14-16.14-5.61-5.58-12.23-9.43-19.86-11.57-10.73-5.63-22.28-8.22-34.68-7.75-23.29-2.34-47.38,7.25-67.71,17.24-14.77,7.25-28.24,18.97-40.73,29.06-16.23,13.1-31.49,27.86-46.32,42.51-35.43,35.01-67.23,73.47-97.79,112.74-21.49,27.61-42.5,55.57-63.81,83.32l14.07-18.21c-6.51,8.33-13.81,16.04-20.71,24.04-13.37,15.51-26.51,31.57-37.54,48.83-3.45,5.4-6.5,11-9.12,16.85-5.2,11.58-11.84,24.84-14.04,37.89-1.71,10.1-3.74,20.56-3.81,30.91,0,1.24,.06,2.47,.14,3.71,.6,9.04,2.08,18.67,3.69,27.59,2.1,11.58,7.51,23.15,13.35,33.1,1.93,3.29,8.22,10.7,7.6,9.9-.79-1.02,5.05,7.3,7.75,9.96,5.96,5.86,13.19,11.29,19.83,15.54,7.82,5.02,16.67,8.61,25.57,11.19,17.85,5.18,30.23,4.51,47.22,2.23,9.68-1.3,18.28-2.38,27.33-5.8,13.45-5.08,26.9-10.71,39.67-17.39,40.26-21.07,76.68-50.62,111.93-78.88,33.71-27.02,66.2-55.63,97.42-85.49,26.77-25.61,52.34-52,74.13-82.07,1.07-1.47,2.1-2.97,3.05-4.53,8.14-14.04,12.24-29.18,12.29-45.42,.47-12.39-2.12-23.95-7.75-34.68-3.63-11.16-9.83-20.81-18.61-28.96-11.23-11.15-24.47-18.87-39.71-23.15-52.88-17.36-106.98,20.01-143.73,54.44-18.02,16.88-33.47,36.28-48.77,55.59-20.81,26.25-42.01,52.21-61.22,79.67-16.15,23.09-31.06,47.03-44.88,71.59-14.75,26.21-30.11,53.39-39.72,81.95-7.63,22.68-9.19,51.47-1.47,74.36,6.09,18.04,14.17,33.7,28.13,47.06s28.37,21.6,46.17,26.41c37.51,10.14,77.44-2.37,108.18-24.38,20.14-14.43,39.44-30.53,58.68-46.19,25.68-20.9,50.29-43.08,74.96-65.15,11.53-10.32,22.96-20.73,35.14-30.29,11.17-8.77,22.66-17.47,31.46-28.74,8.78-8.15,14.98-17.81,18.61-28.96,5.63-10.73,8.22-22.28,7.75-34.68l-3.21-23.93c-4.28-15.25-11.99-28.48-23.15-39.71-14.04-11.24-24.13-20.62-42.22-24.85-8.87-2.08-14.64-4.2-26.47-3.81-7.85,.26-18.94,1.74-26.59,3.54-9.05,2.13-17.54,6.76-25.89,10.91-10.49,5.66-18.91,13.38-25.25,23.18-7.95,8.69-13.32,18.89-16.11,30.61-3.75,11.96-4.29,23.93-1.61,35.89,.54,11.98,4.1,23.13,10.68,33.46,12.39,19.22,30.84,36.13,53.79,41.36l23.93,3.21c16.25-.05,31.39-4.15,45.42-12.29,.97-.52,1.97-.98,2.99-1.38-7.17,3.02-14.33,6.05-21.5,9.07,.89-.35,1.81-.59,2.75-.72l-23.93,3.21,1.31-.06-23.93-3.21c.89,.04,1.73,.24,2.54,.6-7.17-3.02-14.33-6.05-21.5-9.07l1.25,.7c-6.07-4.69-12.14-9.38-18.21-14.07l1.25,1v-127.28c-9.31,11.93-21.63,20.98-33.43,30.29-12.99,10.24-25.13,21.54-37.45,32.57-26.08,23.35-52.18,46.73-79.61,68.5-8.18,6.49-16.17,13.21-24.41,19.62l18.21-14.07c-8.71,6.72-17.81,13.19-27.92,17.63,7.17-3.02,14.33-6.05,21.5-9.07-3.49,1.47-7.04,2.64-10.79,3.2,7.98-1.07,15.95-2.14,23.93-3.21-1.92,.23-3.79,.28-5.72,.07l23.93,3.21c-1.54-.23-2.98-.62-4.41-1.22,7.17,3.02,14.33,6.05,21.5,9.07-.94-.45-1.79-.96-2.64-1.56l18.21,14.07c-1.09-.86-2.03-1.79-2.92-2.86l14.07,18.21c-1.23-1.64-2.18-3.36-2.99-5.24,3.02,7.17,6.05,14.33,9.07,21.5-.7-1.91-1.16-3.8-1.47-5.8l3.21,23.93c-.32-2.97-.25-5.84,.08-8.81l-3.21,23.93c.9-6.42,2.91-12.52,5.36-18.5-3.02,7.17-6.05,14.33-9.07,21.5,4.79-11.31,10.94-22.07,16.7-32.91,7.46-14.06,15.26-27.94,23.43-41.6,16.65-27.86,34.82-54.8,54.65-80.5-4.69,6.07-9.38,12.14-14.07,18.21,13.67-17.63,27.64-35.12,41.85-52.32,14.13-17.09,29.1-33.7,46.61-47.4l-18.21,14.07c9.05-6.95,18.96-13.29,29.35-18.05-7.17,3.02-14.33,6.05-21.5,9.07,2.07-.83,4.05-1.44,6.25-1.79l-23.93,3.21c1.05-.12,2.1-.12,3.14,0l-23.93-3.21c1.08,.13,2.13,.4,3.13,.81-17.93-44.07-35.86-88.14-53.79-132.21-1.58,2.58-3.37,5.02-5.21,7.41,4.69-6.07,9.38-12.14,14.07-18.21-14.5,18.72-31.71,35.52-48.62,52.02-24.56,23.96-50.04,47.01-76.18,69.23-15.3,13-30.86,25.7-46.74,37.98,6.07-4.69,12.14-9.38,18.21-14.07-28.27,21.81-58.08,44.48-91.16,58.55,7.17-3.02,14.33-6.05,21.5-9.07-6.37,2.68-12.99,5.03-19.86,5.99l23.93-3.21c-2.65,.34-5.32,.46-7.98,.13l23.93,3.21c-1.58-.22-3.1-.6-4.58-1.21,7.17,3.02,14.33,6.05,21.5,9.07-1.06-.47-2.05-1.04-2.97-1.75,6.07,4.69,12.14,9.38,18.21,14.07-.82-.66-1.55-1.4-2.2-2.23,4.69,6.07,9.38,12.14,14.07,18.21-.98-1.31-1.67-2.73-2.35-4.22,3.02,7.17,6.05,14.33,9.07,21.5-1.4-3.32-2.32-6.7-2.81-10.26l3.21,23.93c-.39-3.57-.34-7.09,.06-10.65l-3.21,23.93c.82-6.06,2.61-11.83,4.96-17.46-3.02,7.17-6.05,14.33-9.07,21.5,5.02-11.57,12.09-22.07,19.73-32.05l-14.07,18.21c10.14-13.11,21.67-25.01,32.1-37.87,20.49-25.25,39.5-51.79,59.37-77.53l-14.07,18.21c38.06-49.25,77.81-97.46,123.81-139.57,9.8-8.97,19.39-18.16,29.88-26.33-6.07,4.69-12.14,9.38-18.21,14.07,7.07-5.41,14.48-10.37,22.68-13.91-7.17,3.02-14.33,6.05-21.5,9.07,3.84-1.56,7.73-2.73,11.85-3.29l-23.93,3.21c2.3-.23,4.53-.25,6.83-.02l-63.64-153.64c-56.64,47.58-105.44,103.43-159.85,153.39-15.48,14.22-31.43,27.92-48.03,40.81l18.21-14.07c-27.14,20.95-55.43,42.72-87.14,56.2,7.17-3.02,14.33-6.05,21.5-9.07-7,2.92-14.22,5.39-21.74,6.48l23.93-3.21c-3.37,.44-6.73,.57-10.11,.16,7.98,1.07,15.95,2.14,23.93,3.21-2.15-.31-4.21-.84-6.22-1.69l21.5,9.07c-1.34-.61-2.57-1.32-3.76-2.19,6.07,4.69,12.14,9.38,18.21,14.07-1.36-1.06-2.54-2.25-3.61-3.61,4.69,6.07,9.38,12.14,14.07,18.21-1.13-1.53-2.03-3.15-2.8-4.89,3.02,7.17,6.05,14.33,9.07,21.5-1.2-2.91-1.9-5.9-2.33-9.02l3.21,23.93c-.26-2.95-.24-5.81,.04-8.76l-3.21,23.93c.72-5.27,2.2-10.26,4.2-15.18-3.02,7.17-6.05,14.33-9.07,21.5,6.6-15.23,16.45-29.15,26.51-42.26-4.69,6.07-9.38,12.14-14.07,18.21,13.73-17.72,28.93-34.21,44.26-50.54,15.43-16.45,30.48-33.2,45.66-49.88,32.22-35.41,66.08-69.38,102.17-100.85,19.5-17.01,39.79-33.03,60.25-48.86-6.07,4.69-12.14,9.38-18.21,14.07,19-14.66,38.66-28.87,60.86-38.32-7.17,3.02-14.33,6.05-21.5,9.07,8.03-3.31,16.25-5.91,24.79-7.53-29.19-50.14-58.38-100.28-87.57-150.42-14.28,16.1-30.85,29.89-47.61,43.31-17.35,13.89-34.53,28.02-52.1,41.63l18.21-14.07c-37.92,29.3-77.44,56.43-117.4,82.84-21.58,14.26-42.99,29.07-65.13,42.47-12.03,7.28-24.39,14.09-37.34,19.59,7.17-3.02,14.33-6.05,21.5-9.07-8.34,3.49-16.97,6.51-25.96,7.77l23.93-3.21c-3.58,.45-7.14,.6-10.73,.18l23.93,3.21c-2.11-.3-4.15-.78-6.13-1.56l21.5,9.07c-1.68-.71-3.23-1.6-4.68-2.71,6.07,4.69,12.14,9.38,18.21,14.07-1.12-.92-2.1-1.92-3.01-3.04l14.07,18.21c-1.22-1.61-2.19-3.34-2.98-5.21,3.02,7.17,6.05,14.33,9.07,21.5-1.08-2.75-1.73-5.58-2.13-8.51l3.21,23.93c-.97-8.34-.48-17.02,.56-25.33-1.07,7.98-2.14,15.95-3.21,23.93,.95-6.69,2.57-13.13,5.09-19.41l-9.07,21.5c7.08-16.58,19.44-31.51,30.38-45.69-4.69,6.07-9.38,12.14-14.07,18.21,18.8-24.23,38.85-47.62,59.08-70.67,18.49-21.07,38.99-40.24,61.14-57.41-6.07,4.69-12.14,9.38-18.21,14.07,17.41-13.39,36.14-24.47,54.26-36.78,15.3-10.39,30.35-21.52,47.48-28.78-7.17,3.02-14.33,6.05-21.5,9.07,5.11-2.09,10.33-3.76,15.81-4.53l-23.93,3.21c2.78-.31,5.5-.37,8.28-.05l-23.93-3.21c1.31,.2,2.57,.47,3.84,.83-17.93-44.07-35.86-88.14-53.79-132.21-.86,1.74-1.87,3.32-3.03,4.88,4.69-6.07,9.38-12.14,14.07-18.21-3.43,4.29-7.55,7.88-11.85,11.27,6.07-4.69,12.14-9.38,18.21-14.07-12.18,9.41-24.94,18.25-37.4,27.28-14.73,10.68-29.9,20.76-45.33,30.39s-30.67,18.44-46.21,27.33c-15.46,8.84-31.06,17.44-47.44,24.47l21.5-9.07c-13.53,5.69-27.49,10.21-42.05,12.34l23.93-3.21c-11.52,1.52-23.59,2.25-35.13,.73l23.93,3.21c-2.41-.37-4.76-.85-7.04-1.74l21.5,9.07c-.86-.39-1.65-.82-2.41-1.38,6.07,4.69,12.14,9.38,18.21,14.07-.31-.25-.59-.53-.85-.84,4.69,6.07,9.38,12.14,14.07,18.21-.42-.59-.74-1.19-1.03-1.86l9.07,21.5c-.31-.84-.51-1.68-.64-2.57l3.21,23.93c-.11-1.16-.08-2.28,.05-3.43l-3.21,23.93c.33-2.24,1.01-4.37,1.86-6.46-3.02,7.17-6.05,14.33-9.07,21.5,2.45-5.69,5.98-10.83,9.72-15.74-4.69,6.07-9.38,12.14-14.07,18.21,12.65-16.36,28.03-30.55,43.34-44.37,16.92-15.26,32.74-31.93,50.78-45.87l-18.21,14.07c9.13-6.93,18.81-12.99,29.39-17.46l-21.5,9.07c2.53-1.02,5.08-1.95,7.68-2.8,11.71-2.78,21.91-8.15,30.61-16.11,9.8-6.35,17.52-14.76,23.18-25.25,6.58-10.33,10.14-21.48,10.68-33.46,2.68-11.96,2.14-23.93-1.61-35.89-7.05-21.78-20.54-42.79-41.36-53.79S237.95-4.09,214.84,3.46h0Z"
              strokeLinecap="round"
              fill="none"
              pointerEvents="all"
            />
          </svg>
        </div>
        <div className="relative z-10 w-full h-full">
          <Image
            src={imagePath}
            alt="Scribble Background"
            fill
            sizes="100%"
            style={{ objectFit: "cover" }}
            className="rounded-[55px]"
          />
        </div>
      </div>
      <div className="spacer"></div>


      <style jsx>{`

        path {
          stroke-width: 200;
          stroke-dasharray: 14144.1875;
          stroke-dashoffset: 14144.1875;
          view-timeline-name: --scribble-path;
          view-timeline-axis: block;
          animation: 3s ease-in-out draw both;
          animation-timeline: --scribble-path;
          animation-range: entry 20% cover 55%;
        }

        @keyframes draw {
          to {
            stroke-dashoffset: 0;
          }
        }
      `}</style>
    </div>
  );
};

export default ScrollDrivenScribbles;


